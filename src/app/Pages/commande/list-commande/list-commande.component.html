<div class="list-commande-container">
  <!-- Alert Messages -->
  <div *ngIf="showAlert" class="alert-container" [ngClass]="alertType === 'success' ? 'alert-success' : 'alert-error'">
    <div class="alert-content">
      <i class="bi" [ngClass]="alertType === 'success' ? 'bi-check-circle-fill' : 'bi-exclamation-triangle-fill'"></i>
      <span>{{ alertMessage }}</span>
      <button class="alert-close" (click)="closeAlert()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
  </div>

  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-left">
        <div class="header-icon">
          <i class="bi bi-receipt-cutoff"></i>
        </div>
        <div>
          <h1 class="page-title">Liste des Commandes</h1>
          <p class="page-subtitle">Consultez toutes vos commandes et leurs détails</p>
        </div>
      </div>
      <div class="header-stats">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="bi bi-cart-check"></i>
          </div>
          <div class="stat-info">
            <p class="stat-label">Total Commandes</p>
            <p class="stat-value">{{ getCommandesFiltrees().length }}</p>
          </div>
        </div>
        <div class="stat-card total-card">
          <div class="stat-icon">
            <i class="bi bi-cash-stack"></i>
          </div>
          <div class="stat-info">
            <p class="stat-label">Total Général</p>
            <p class="stat-value">{{ formatPrice(getTotalGeneralFiltre()) }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Section Navigation et Filtres -->
  <div class="navigation-section">
    <div class="nav-header">
      <h3 class="nav-title">
        <i class="bi bi-compass"></i>
        Navigation rapide
      </h3>
      <p class="nav-subtitle">Accédez rapidement aux commandes par période</p>
    </div>
    <div class="nav-buttons">
      <a routerLink="/commande-du-jour" class="nav-btn nav-jour">
        <div class="nav-icon">
          <i class="bi bi-sun"></i>
        </div>
        <div class="nav-content">
          <span class="nav-label">Commandes du jour</span>
          <span class="nav-desc">Voir les commandes d'aujourd'hui</span>
        </div>
        <i class="bi bi-arrow-right-circle nav-arrow"></i>
      </a>
      <a routerLink="/commande-semaine" class="nav-btn nav-semaine">
        <div class="nav-icon">
          <i class="bi bi-calendar-week"></i>
        </div>
        <div class="nav-content">
          <span class="nav-label">Commandes de la semaine</span>
          <span class="nav-desc">Voir les commandes hebdomadaires</span>
        </div>
        <i class="bi bi-arrow-right-circle nav-arrow"></i>
      </a>
      <a routerLink="/commande-mois" class="nav-btn nav-mois">
        <div class="nav-icon">
          <i class="bi bi-calendar-month"></i>
        </div>
        <div class="nav-content">
          <span class="nav-label">Commandes du mois</span>
          <span class="nav-desc">Voir les commandes mensuelles</span>
        </div>
        <i class="bi bi-arrow-right-circle nav-arrow"></i>
      </a>
    </div>
  </div>

  <!-- Filtres de période -->
  <div class="filter-section">
    <div class="filter-header">
      <h3 class="filter-title">
        <i class="bi bi-funnel"></i>
        Filtrer cette page
      </h3>
      <p class="filter-subtitle">Filtrer les commandes affichées sur cette page</p>
    </div>
    <div class="filter-buttons">
      <button
        class="filter-btn"
        [class.active]="periodeFiltre === 'journee'"
        (click)="filtrerParPeriode('journee')">
        <i class="bi bi-sun"></i>
        <span>Aujourd'hui</span>
        <span class="filter-count">{{ getCountByPeriode('journee') }}</span>
      </button>
      <button
        class="filter-btn"
        [class.active]="periodeFiltre === 'hebdomadaire'"
        (click)="filtrerParPeriode('hebdomadaire')">
        <i class="bi bi-calendar-week"></i>
        <span>Cette semaine</span>
        <span class="filter-count">{{ getCountByPeriode('hebdomadaire') }}</span>
      </button>
      <button
        class="filter-btn"
        [class.active]="periodeFiltre === 'mensuel'"
        (click)="filtrerParPeriode('mensuel')">
        <i class="bi bi-calendar-month"></i>
        <span>Ce mois</span>
        <span class="filter-count">{{ getCountByPeriode('mensuel') }}</span>
      </button>
      <button
        class="filter-btn reset-btn"
        [class.active]="periodeFiltre === 'tous'"
        (click)="filtrerParPeriode('tous')">
        <i class="bi bi-arrow-clockwise"></i>
        <span>Toutes</span>
        <span class="filter-count">{{ commandes.length }}</span>
      </button>
    </div>
    <div class="filter-info" *ngIf="periodeFiltre !== 'tous'">
      <i class="bi bi-info-circle"></i>
      <span>{{ getFilterInfoText() }}</span>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Chargement des commandes...</p>
  </div>

  <!-- Liste vide -->
  <div *ngIf="!isLoading && getCommandesFiltrees().length === 0" class="empty-state">
    <i class="bi bi-inbox"></i>
    <h3>Aucune commande</h3>
    <p *ngIf="periodeFiltre === 'tous'">Il n'y a aucune commande pour le moment</p>
    <p *ngIf="periodeFiltre === 'journee'">Aucune commande aujourd'hui</p>
    <p *ngIf="periodeFiltre === 'hebdomadaire'">Aucune commande cette semaine</p>
    <p *ngIf="periodeFiltre === 'mensuel'">Aucune commande ce mois-ci</p>
    <button class="btn-reset" (click)="filtrerParPeriode('tous')" *ngIf="periodeFiltre !== 'tous'">
      <i class="bi bi-arrow-left"></i>
      Voir toutes les commandes
    </button>
  </div>

  <!-- Liste des commandes -->
  <div *ngIf="!isLoading && getCommandesFiltrees().length > 0" class="commandes-section">
    <div class="section-header">
      <h3 class="section-title">
        <i class="bi bi-list-ul"></i>
        Liste des commandes
        <span class="badge-count">{{ getCommandesFiltrees().length }}</span>
      </h3>
    </div>

    <!-- Remplacer la section commandes-grid par celle-ci -->
<!-- Remplacer la section commandes-grid par celle-ci -->
<div class="commandes-grid">
  <div *ngFor="let commande of getCommandesPaginees()" class="commande-card">

    <!-- Bouton suppression discret en haut à droite -->
    <button
      class="btn-delete-subtle"
      (click)="openDeleteModal(commande, $event)"
      title="Supprimer cette commande">
      <i class="bi bi-x"></i>
    </button>

    <!-- Contenu cliquable pour les détails -->
    <div (click)="openDetailModal(commande)" style="cursor: pointer;">
      <div class="commande-header">
        <div class="commande-id">
          <i class="bi bi-hash"></i>
          <span>{{ commande.idCommande }}</span>
        </div>
        <div class="commande-date">
          <i class="bi bi-calendar3"></i>
          <span>{{ formatDate(commande.date) }}</span>
        </div>
      </div>

      <div class="commande-client">
        <i class="bi bi-person-fill"></i>
        <span>{{ commande.nomClient }}</span>
      </div>

      <div class="commande-details">
        <div class="detail-item">
          <i class="bi bi-box-seam"></i>
          <span>{{ commande.details.length || 0 }} article(s)</span>
        </div>
      </div>

      <div class="commande-footer">
        <span class="commande-total">{{ formatPrice(commande.total) }}</span>
        <button class="btn-detail">
          <i class="bi bi-eye"></i>
          <span>Détails</span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- AJOUTER CE MODAL DE SUPPRESSION À LA FIN, AVANT LA FERMETURE DE </div> principale -->

<!-- Modal Suppression Commande -->
<div *ngIf="showDeleteModal && commandeToDelete" class="modal-overlay" (click)="closeDeleteModal()">
  <div class="modal-content modal-delete-commande" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>
        <i class="bi bi-exclamation-triangle me-2"></i>
        Confirmer la suppression
      </h2>
      <button class="modal-close" (click)="closeDeleteModal()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <div class="modal-body">
      <div class="delete-warning">
        <i class="bi bi-exclamation-circle"></i>
        <div>
          <p class="warning-title">Êtes-vous sûr de vouloir supprimer cette commande ?</p>
          <div class="commande-info">
            <p><strong>Commande #{{ commandeToDelete.idCommande }}</strong></p>
            <p>Client : <strong>{{ commandeToDelete.nomClient }}</strong></p>
            <p>Date : {{ formatDate(commandeToDelete.date) }}</p>
            <p>Montant : <strong>{{ formatPrice(commandeToDelete.total) }}</strong></p>
          </div>
          <p class="text-danger">⚠️ Cette action est irréversible et supprimera définitivement cette commande.</p>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn-cancel-delete" (click)="closeDeleteModal()">
        <i class="bi bi-x-circle me-2"></i>
        Annuler
      </button>
      <button type="button" class="btn-confirm-delete" (click)="confirmDelete()" [disabled]="isLoading">
        <i class="bi" [ngClass]="isLoading ? 'bi-arrow-clockwise spin' : 'bi-trash'"></i>
        <span>{{ isLoading ? 'Suppression...' : 'Supprimer définitivement' }}</span>
      </button>
    </div>
  </div>
</div>

    <!-- Pagination -->
    <div class="pagination-container" *ngIf="totalPages > 1">
      <div class="pagination-info">
        <span>Page {{ currentPage }} sur {{ totalPages }}</span>
        <span class="separator">|</span>
        <span>{{ getCommandesFiltrees().length }} commande(s) au total</span>
      </div>

      <div class="pagination-controls">
        <button
          class="pagination-btn"
          (click)="previousPage()"
          [disabled]="currentPage === 1">
          <i class="bi bi-chevron-left"></i>
        </button>

        <button
          *ngFor="let page of getPageNumbers()"
          class="pagination-number"
          [class.active]="page === currentPage"
          [class.dots]="page === -1"
          (click)="page !== -1 && goToPage(page)"
          [disabled]="page === -1">
          {{ page === -1 ? '...' : page }}
        </button>

        <button
          class="pagination-btn"
          (click)="nextPage()"
          [disabled]="currentPage === totalPages">
          <i class="bi bi-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Détails Commande -->
  <div *ngIf="showDetailModal && commandeSelectionnee" class="modal-overlay" (click)="closeDetailModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>
          <i class="bi bi-receipt me-2"></i>
          Détails de la Commande #{{ commandeSelectionnee.idCommande }}
        </h2>
        <button class="modal-close" (click)="closeDetailModal()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>

      <div class="modal-body">
        <!-- Informations générales -->
        <div class="info-section">
          <div class="info-row">
            <div class="info-item">
              <i class="bi bi-person-fill"></i>
              <div>
                <p class="info-label">Client</p>
                <p class="info-value">{{ commandeSelectionnee.nomClient }}</p>
              </div>
            </div>
            <div class="info-item">
              <i class="bi bi-calendar3"></i>
              <div>
                <p class="info-label">Date</p>
                <p class="info-value">{{ formatDate(commandeSelectionnee.date) }}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Détails produits -->
        <div class="produits-section">
          <h3 class="section-title">
            <i class="bi bi-box-seam me-2"></i>
            Articles commandés
          </h3>

          <div class="produits-table">
            <table>
              <thead>
                <tr>
                  <th>Produit</th>
                  <th>Couleur</th>
                  <th>Taille</th>
                  <th>Qté</th>
                  <th>Prix Unit.</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let detail of commandeSelectionnee.details">
                  <td>
                    <strong>{{ detail.nomModele }}</strong>
                  </td>
                  <td>
                    <span class="couleur-badge" [style.background-color]="detail.couleur">
                      {{ detail.couleur }}
                    </span>
                  </td>
                  <td>{{ detail.taille }}</td>
                  <td>{{ detail.quantite }}</td>
                  <td>{{ formatPrice(detail.prixUnitaire) }}</td>
                  <td class="total-cell">{{ formatPrice(detail.totalLigne) }}</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Total commande -->
          <div class="total-commande">
            <span>Total de la Commande</span>
            <span class="total-value">{{ formatPrice(commandeSelectionnee.total) }}</span>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-close-modal" (click)="closeDetailModal()">
          <i class="bi bi-x-circle me-2"></i>
          Fermer
        </button>
      </div>
    </div>
  </div>
</div>

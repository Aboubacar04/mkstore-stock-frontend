<div class="commande-semaine-container">
  <!-- Alert Messages -->
  <div *ngIf="showAlert" class="alert-container" [ngClass]="alertType === 'success' ? 'alert-success' : 'alert-error'">
    <div class="alert-content">
      <i class="bi" [ngClass]="alertType === 'success' ? 'bi-check-circle-fill' : 'bi-exclamation-triangle-fill'"></i>
      <span>{{ alertMessage }}</span>
      <button class="alert-close" (click)="closeAlert()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
  </div>

  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-left">
        <div class="header-icon">
          <i class="bi bi-calendar-week"></i>
        </div>
        <div>
          <h1 class="page-title">Commandes de la Semaine</h1>
          <p class="page-subtitle">
            <i class="bi bi-calendar-range me-2"></i>
            Semaine {{ numeroSemaine }} : {{ formatPlageDates() }}
          </p>
        </div>
      </div>
      <button class="btn-refresh" (click)="rafraichir()" [disabled]="isLoading">
        <i class="bi" [ngClass]="isLoading ? 'bi-arrow-clockwise spin' : 'bi-arrow-clockwise'"></i>
        <span>Actualiser</span>
      </button>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card primary">
      <div class="stat-icon">
        <i class="bi bi-cart-check"></i>
      </div>
      <div class="stat-info">
        <p class="stat-label">Total Commandes</p>
        <p class="stat-value">{{ getNombreCommandesSemaine() }}</p>
        <p class="stat-detail">Cette semaine</p>
      </div>
    </div>

    <div class="stat-card success">
      <div class="stat-icon">
        <i class="bi bi-cash-stack"></i>
      </div>
      <div class="stat-info">
        <p class="stat-label">Total Semaine</p>
        <p class="stat-value">{{ formatPrice(getTotalSemaine()) }}</p>
        <p class="stat-detail">Chiffre d'affaires</p>
      </div>
    </div>

    <div class="stat-card info">
      <div class="stat-icon">
        <i class="bi bi-graph-up-arrow"></i>
      </div>
      <div class="stat-info">
        <p class="stat-label">Moyenne/Commande</p>
        <p class="stat-value">
          {{ getNombreCommandesSemaine() > 0 ? formatPrice(getTotalSemaine() / getNombreCommandesSemaine()) : formatPrice(0) }}
        </p>
        <p class="stat-detail">Panier moyen</p>
      </div>
    </div>

    <div class="stat-card warning">
      <div class="stat-icon">
        <i class="bi bi-calendar-day"></i>
      </div>
      <div class="stat-info">
        <p class="stat-label">Moyenne/Jour</p>
        <p class="stat-value">
          {{ formatPrice(getTotalSemaine() / 7) }}
        </p>
        <p class="stat-detail">Sur 7 jours</p>
      </div>
    </div>
  </div>

  <!-- Graphique par jour (Résumé) -->
  <div class="resume-semaine">
    <h3 class="resume-title">
      <i class="bi bi-bar-chart-line"></i>
      Répartition par jour
    </h3>
    <div class="jours-grid">
      <div *ngFor="let jour of [0,1,2,3,4,5,6]" class="jour-card" [class.aujourd-hui]="jour === dateDebutSemaine.getDay()">
        <div class="jour-header">
          <span class="jour-nom">{{ getNomJour(jour) }}</span>
          <span class="jour-count">{{ getCommandesParJour(jour).length }}</span>
        </div>
        <div class="jour-total">
          {{ formatPrice(getTotalParJour(jour)) }}
        </div>
        <div class="jour-progress">
          <div class="progress-bar"
               [style.width]="(getTotalParJour(jour) / getTotalSemaine() * 100) + '%'"
               [style.background-color]="jour === 0 || jour === 6 ? '#F7B893' : '#28a745'">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Chargement des commandes de la semaine...</p>
  </div>

  <!-- Aucune commande -->
  <div *ngIf="!isLoading && commandesSemaine.length === 0" class="empty-state">
    <i class="bi bi-calendar-x"></i>
    <h3>Aucune commande cette semaine</h3>
    <p>Il n'y a pas encore de commande pour la semaine {{ numeroSemaine }}</p>
  </div>

  <!-- Liste des commandes -->
  <div *ngIf="!isLoading && commandesSemaine.length > 0" class="commandes-section">
    <div class="section-header">
      <h2 class="section-title">
        <i class="bi bi-list-ul me-2"></i>
        Liste des Commandes
        <span class="badge-count">{{ commandesSemaine.length }}</span>
      </h2>
    </div>

    <div class="commandes-grid">
      <div *ngFor="let commande of getCommandesPaginees()"
           class="commande-card"
           (click)="openDetailModal(commande)">
        <div class="commande-header">
          <div class="commande-id">
            <i class="bi bi-hash"></i>
            <span>{{ commande.idCommande }}</span>
          </div>
          <div class="commande-date">
            <i class="bi bi-calendar3"></i>
            <span>{{ formatDateTime(commande.date) }}</span>
          </div>
        </div>

        <div class="commande-client">
          <i class="bi bi-person-fill"></i>
          <span>{{ commande.nomClient }}</span>
        </div>

        <div class="commande-details">
          <div class="detail-item">
            <i class="bi bi-box-seam"></i>
            <span>{{ commande.details.length || 0 }} article(s)</span>
          </div>
          <div class="detail-item">
            <i class="bi bi-clock"></i>
            <span>{{ formatTime(commande.date) }}</span>
          </div>
        </div>

        <div class="commande-footer">
          <span class="commande-total">{{ formatPrice(commande.total) }}</span>
          <button class="btn-detail">
            <i class="bi bi-eye"></i>
            <span>Détails</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination-container" *ngIf="totalPages > 1">
      <div class="pagination-info">
        <span>Page {{ currentPage }} sur {{ totalPages }}</span>
        <span class="separator">|</span>
        <span>{{ commandesSemaine.length }} commande(s) au total</span>
      </div>

      <div class="pagination-controls">
        <button
          class="pagination-btn"
          (click)="previousPage()"
          [disabled]="currentPage === 1">
          <i class="bi bi-chevron-left"></i>
        </button>

        <button
          *ngFor="let page of getPageNumbers()"
          class="pagination-number"
          [class.active]="page === currentPage"
          [class.dots]="page === -1"
          (click)="page !== -1 && goToPage(page)"
          [disabled]="page === -1">
          {{ page === -1 ? '...' : page }}
        </button>

        <button
          class="pagination-btn"
          (click)="nextPage()"
          [disabled]="currentPage === totalPages">
          <i class="bi bi-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Détails Commande -->
  <div *ngIf="showDetailModal && commandeSelectionnee" class="modal-overlay" (click)="closeDetailModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>
          <i class="bi bi-receipt me-2"></i>
          Détails de la Commande #{{ commandeSelectionnee.idCommande }}
        </h2>
        <button class="modal-close" (click)="closeDetailModal()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>

      <div class="modal-body">
        <!-- Informations générales -->
        <div class="info-section">
          <div class="info-row">
            <div class="info-item">
              <i class="bi bi-person-fill"></i>
              <div>
                <p class="info-label">Client</p>
                <p class="info-value">{{ commandeSelectionnee.nomClient }}</p>
              </div>
            </div>
            <div class="info-item">
              <i class="bi bi-calendar3"></i>
              <div>
                <p class="info-label">Date et Heure</p>
                <p class="info-value">{{ formatDateTime(commandeSelectionnee.date) }}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Détails produits -->
        <div class="produits-section">
          <h3 class="section-title">
            <i class="bi bi-box-seam me-2"></i>
            Articles commandés
          </h3>

          <div class="produits-table">
            <table>
              <thead>
                <tr>
                  <th>Produit</th>
                  <th>Couleur</th>
                  <th>Taille</th>
                  <th>Qté</th>
                  <th>Prix Unit.</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let detail of commandeSelectionnee.details">
                  <td>
                    <strong>{{ detail.nomModele }}</strong>
                  </td>
                  <td>
                    <span class="couleur-badge" [style.background-color]="detail.couleur">
                      {{ detail.couleur }}
                    </span>
                  </td>
                  <td>{{ detail.taille }}</td>
                  <td>{{ detail.quantite }}</td>
                  <td>{{ formatPrice(detail.prixUnitaire) }}</td>
                  <td class="total-cell">{{ formatPrice(detail.totalLigne) }}</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Total commande -->
          <div class="total-commande">
            <span>Total de la Commande</span>
            <span class="total-value">{{ formatPrice(commandeSelectionnee.total) }}</span>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-close-modal" (click)="closeDetailModal()">
          <i class="bi bi-x-circle me-2"></i>
          Fermer
        </button>
      </div>
    </div>
  </div>
</div>

<div class="rupture-container">
  <!-- Alert Messages -->
  <div *ngIf="showAlert" class="alert-container" [ngClass]="alertType === 'success' ? 'alert-success' : 'alert-error'">
    <div class="alert-content">
      <i class="bi" [ngClass]="alertType === 'success' ? 'bi-check-circle-fill' : 'bi-exclamation-triangle-fill'"></i>
      <span>{{ alertMessage }}</span>
      <button class="alert-close" (click)="closeAlert()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
  </div>

  <!-- Header Danger -->
  <div class="danger-header">
    <div class="danger-animation">
      <i class="bi bi-exclamation-triangle-fill"></i>
    </div>
    <div class="header-content">
      <h1 class="page-title">
        <i class="bi bi-shield-exclamation me-2"></i>
        Alerte Rupture de Stock
      </h1>
      <p class="page-subtitle">Modèles avec stock critique (≤ 3 pièces)</p>
    </div>
    <button class="btn-refresh" (click)="rafraichir()" [disabled]="isLoading">
      <i class="bi" [ngClass]="isLoading ? 'bi-arrow-clockwise spin' : 'bi-arrow-clockwise'"></i>
      <span>Actualiser</span>
    </button>
  </div>

  <!-- Stats Card -->
  <div class="stats-danger">
    <div class="stat-item">
      <i class="bi bi-exclamation-octagon"></i>
      <div>
        <p class="stat-number">{{ modelesEnRupture.length }}</p>
        <p class="stat-label">Modèle(s) en Alerte</p>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Vérification du stock...</p>
  </div>

  <!-- Aucun modèle en rupture -->
  <div *ngIf="!isLoading && modelesEnRupture.length === 0" class="no-rupture">
    <i class="bi bi-check-circle"></i>
    <h3>Aucun modèle en rupture</h3>
    <p>Tous les modèles ont un stock suffisant</p>
  </div>

  <!-- Liste des modèles en rupture -->
  <div *ngIf="!isLoading && modelesEnRupture.length > 0" class="rupture-grid">
    <div *ngFor="let modele of modelesEnRupture"
         class="rupture-card"
         [ngClass]="getNiveauCriticite(modele.total_pieces)">

      <!-- Badge de criticité -->
      <div class="criticite-badge">
        <i class="bi" [ngClass]="getIconeCriticite(modele.total_pieces)"></i>
        <span>{{ getTexteCriticite(modele.total_pieces) }}</span>
      </div>

      <!-- Image -->
      <div class="modele-image-container">
        <img *ngIf="modele.image && !hasImageError(modele.id_modele)"
             [src]="getImageUrl(modele.image)"
             [alt]="modele.nom_modele"
             (error)="onImageError(modele.id_modele)"
             class="modele-image">
        <div *ngIf="!modele.image || hasImageError(modele.id_modele)" class="no-image">
          <i class="bi bi-image"></i>
        </div>

        <!-- Overlay danger -->
        <div class="danger-overlay">
          <i class="bi bi-exclamation-triangle-fill"></i>
        </div>
      </div>

      <!-- Contenu -->
      <div class="modele-content">
        <h3 class="modele-nom">{{ modele.nom_modele }}</h3>
        <p class="modele-type">
          <i class="bi bi-tag"></i>
          {{ modele.type }}
        </p>

        <!-- Stock restant -->
        <div class="stock-info">
          <div class="stock-gauge">
            <div class="gauge-bar">
              <div class="gauge-fill" [style.width]="(modele.total_pieces / 3) * 100 + '%'"></div>
            </div>
          </div>
          <div class="stock-text">
            <i class="bi bi-box-seam"></i>
            <span class="stock-number">{{ modele.total_pieces }}</span>
            <span class="stock-label">pièce(s) restante(s)</span>
          </div>
        </div>

        <!-- Prix -->
        <div class="modele-prix">
          <span class="prix-label">Prix unitaire</span>
          <span class="prix-value">{{ formatPrice(modele.prix_unitaire) }}</span>
        </div>

        <!-- Actions -->
        <div class="card-actions">
          <button class="btn-action urgent">
            <i class="bi bi-plus-circle"></i>
            Réapprovisionner
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
